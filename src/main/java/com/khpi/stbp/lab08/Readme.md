# Лабораторна №8

## Time-based One Time Password

---

### Мета: дослідити і реалізувати механізм генерації одноразових паролів TOTP.

### Завдання:

Дослідити та реалізувати алгоритм ```Time-based One Time Password```. Створити програму, 
що демонструє роботу розробленого алгоритму. Організувати взаємодію з мобільним додатком ```Google Authenticator```.

### Хід роботи

TOTP алгоритм використовує HOTP алгоритм, в якому заміняється лічильник на число на основі поточного часу

Для початку підраховується лічильник **Ct**.

```math
    Ct = (T - T0) / Tx
```

- T - це поточний час в секундах
- T0 - початковий час відліку, тобто = 0
- Tx - тривалість часу, зазвичай = 30

---

Використання TOTP алгоритму.

- H - hash метод, який буде використовуватись, зазвичай SHA-1
- K - секретний ключ, байтовий рядок який залишається приватним
- C - лічильник утворений попередньо
- d - довжина паролю, 6 або 8 значень зазвичай.

***C*** і ***K*** переводяться у масив байтів, далі ці масиви використовуються у хешуванні ***C*** методом ***H***.
Нижче приклад розбиття утвореного хешу для ***d = 6***.

```
int offset = hash[hash.length - 1] & 0xf;

int binary =
        ((hash[offset] & 0x7f) << 24) |
                ((hash[offset + 1] & 0xff) << 16) |
                ((hash[offset + 2] & 0xff) << 8) |
                (hash[offset + 3] & 0xff);

int otp = binary % DIGITS_POWER[codeDigits];


Де DIGITS_POWER[6] = 100_000
```

### Результат роботи

```
Time now: 1669809317 
Hex val: 0000000003514F16
Time in bytes: [0, 0, 0, 0, 3, 81, 79, 22]
Hashed time: [-89, 14, 67, 47, 24, -78, 108, -63, -21, -97, -44, -11, -34, -49, 21, -38, -109, 122, 111, 117]
TOTP: 988331
```